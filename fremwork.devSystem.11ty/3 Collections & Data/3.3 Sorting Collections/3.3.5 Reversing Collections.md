# Reversing Collections: The Newest-First Pattern

Reversing is the most common transformation applied to collections. Nearly every blog, news site, and changelog displays content newest-first, while Eleventy's default is oldest-first. Understanding the different reversal mechanisms—and their subtle differences—prevents unexpected behavior.

---

## The Fundamental Principle: Reversal Happens Somewhere

You have three places to reverse a collection's order:

1. **In the Config** (`addCollection`): Permanent, affects all uses
2. **In the Template** (`| reverse` filter): Local, affects only that loop
3. **In Pagination** (`reverse: true`): Specific to paginated pages

Each has trade-offs. Choosing the right location determines whether reversal is global or scoped.

---

## Reversing in Configuration

When you want a collection to **always** appear newest-first:

```javascript
eleventyConfig.addCollection("posts", collection => {
  return collection.getFilteredByTag("post")
    .sort((a, b) => b.date - a.date); // Descending sort
});
```

Or, using explicit reversal:

```javascript
eleventyConfig.addCollection("posts", collection => {
  return collection.getFilteredByTag("post")
    .reverse(); // Reverses the default ascending order
});
```

**Caution:** `.reverse()` in JavaScript **mutates the original array**. If you're working with a shared reference, use:

```javascript
return [...collection.getFilteredByTag("post")].reverse();
```

The spread syntax (`[...array]`) creates a shallow copy before reversing.

---

## Reversing in Templates

When you want the option to display content both ways:

**Newest First (Blog Index):**

```html
{% for post in collections.post | reverse %}
  ...
{% endfor %}
```

**Oldest First (Archive Page):**

```html
{% for post in collections.post %}
  ...
{% endfor %}
```

The `| reverse` filter in Nunjucks/Liquid creates a **new reversed array**. It doesn't modify the original collection, so different templates can display the same collection in different orders.

---

## Reversing in Pagination

When paginating a collection, you can reverse the source data:

```yaml
---
pagination:
  data: collections.post
  size: 10
  reverse: true
---
```

This is equivalent to `collections.post | reverse` but specific to the pagination context. Page 1 shows the 10 newest posts, Page 2 shows the next 10, etc.

---

## Combining Reversal with Limits

A common pattern is "Show the 5 most recent posts":

**Template Approach:**

```html
{% for post in collections.post | reverse | slice(0, 5) %}
  ...
{% endfor %}
```

**Collection Approach:**

```javascript
eleventyConfig.addCollection("recentPosts", collection => {
  return collection.getFilteredByTag("post")
    .sort((a, b) => b.date - a.date)
    .slice(0, 5);
});
```

The collection approach is more performant if you use this list on multiple pages—the slice happens once during build, not once per template render.

---

## The Mutation Trap

JavaScript's `.reverse()` is a **mutating method**. It changes the array in place and returns a reference to the same array:

```javascript
const original = [1, 2, 3];
const reversed = original.reverse();

console.log(original);  // [3, 2, 1] — ALSO reversed!
console.log(reversed);  // [3, 2, 1]
console.log(original === reversed); // true — Same reference
```

In Eleventy, if you reverse a collection that's used elsewhere, you might accidentally reverse it for all templates.

**Safe Pattern:**

```javascript
// Create a copy, then reverse the copy
return [...collection.getFilteredByTag("post")].reverse();
```

Or sort descending directly (which creates a new array order):

```javascript
return collection.getFilteredByTag("post")
  .sort((a, b) => b.date - a.date);
```

---

## When NOT to Reverse

- **Tutorials/Series**: Steps should be in order (Part 1, Part 2...)
- **Documentation**: Chapters follow logical, not chronological, flow
- **Timelines**: Historical events often display oldest-first

For these cases, keep the default ascending order or use custom order keys.

---

## Common Pitfalls and Solutions

**Problem:** Pagination shows oldest posts first despite `reverse: true`.

**Cause:** The source collection was already reversed in config, so reversing again returns to oldest-first.

**Solution:** Only reverse in one place. If the collection is already newest-first, don't use `reverse: true` in pagination.

---

**Problem:** Recent posts widget shows wrong items.

**Cause:** Forgot `.slice()` or used wrong limit.

**Solution:** Verify the chain: `| reverse | slice(0, 5)` in Nunjucks, or `.slice(0, 5)` in config.

---

**Problem:** Reversal seems random or inconsistent.

**Cause:** Items have identical dates, and sort stability isn't guaranteed.

**Solution:** Add a secondary sort key (title, filename) to ensure consistent order.

---

## Quick Reference

| Location | Syntax | Scope |
| :--- | :--- | :--- |
| **Config** | `.sort((a,b) => b.date - a.date)` | Global (all uses) |
| **Config** | `[...array].reverse()` | Global (safe copy) |
| **Template** | `\| reverse` | Local (that loop only) |
| **Pagination** | `reverse: true` | Pagination only |
| **Limit** | `\| slice(0, 5)` or `.slice(0, 5)` | Combine with reverse |

---

_This guide covers collection reversal. Natural progressions include **limiting collections**, **creating derived collections**, and **conditional display based on position**._

# Data Sources Priority: Debugging Where Values Originate

When a variable has an unexpected value, you need to trace it back to its source. Understanding the exact priority order—and how to debug it—is essential for maintaining complex Eleventy projects.

---

## The Fundamental Principle: Specificity Wins

The closer a data source is to the actual content file, the higher its priority. Think of it as **locality beats generality**:

- Global data is like city-wide regulations
- Directory data is like neighborhood rules
- Front matter is like your personal preferences

Your personal preferences override the neighborhood rules, which override the city regulations.

---

## The Complete Priority Stack

From lowest to highest (higher numbers win):

| Priority | Source | Locality |
| :--- | :--- | :--- |
| 1 | `addGlobalData()` in config | Project-wide |
| 2 | Global data files (`_data/*.json`) | Project-wide |
| 3 | Directory data files (`dir/dir.11tydata.js`) | Folder-level |
| 4 | Template data files (`file.11tydata.json`) | Single file |
| 5 | Layout chain front matter | Layout(s) used |
| 6 | Template front matter | The file itself |
| 7 | `eleventyComputed` | Final pass |

---

## Tracing a Value's Origin

**Scenario:** Your template shows `author: "Anonymous"` but you expected "John Doe".

**Debug Process:**

1. **Check Front Matter:** Does the file have `author:` defined?
2. **Check Layout Chain:** Does any layout in the chain define `author:`?
3. **Check Template Data File:** Is there a `filename.11tydata.json`?
4. **Check Directory Data:** Is there a `folder.11tydata.json`?
5. **Check Global Data:** Is there an `_data/site.json` with `author`?

The first place you find it (starting from top) is where the value comes from.

---

## The Debug Filter Technique

Create a filter to inspect the final merged data:

```javascript
eleventyConfig.addFilter("debug", (value) => {
  console.log(JSON.stringify(value, null, 2));
  return "";
});
```

Use it sparingly in templates:

```html
{{ page | debug }}
{{ author | debug }}
```

The output appears in your terminal during build.

---

## Layout Chain Priority

When layouts chain (`post.njk` → `base.njk`), data flows **inward**:

```
base.njk:     showFooter: true
  └── post.njk:   showFooter: false
      └── article.md:  (no showFooter defined)
```

**Result:** `showFooter` is `false` (from `post.njk`)

The layout **closest to the content** wins. `post.njk` is closer than `base.njk`.

---

## Environment Variables

Data can also come from `process.env`:

```javascript
// eleventy.config.js
eleventyConfig.addGlobalData("isProd", process.env.NODE_ENV === "production");
```

This sits at priority level 1 (lowest), so any other source can override it. However, it's useful for environment-specific defaults.

---

## Common Pitfalls and Solutions

**Problem:** Value is wrong but you can't find where it's defined.

**Solution:** 
1. Use the debug filter to log the final value
2. Systematically remove data files from each layer to isolate the source
3. Check for typos (case sensitivity matters)

---

**Problem:** Layout data doesn't appear in template.

**Cause:** The data key might be defined in front matter as empty string or null.

**Solution:** Remove the key entirely from front matter to inherit from layout, or explicitly set the desired value.

---

**Problem:** Global data applies to unexpected templates.

**Cause:** Filename collision. `_data/page.json` creates a `page` variable that conflicts with Eleventy's built-in `page` object.

**Solution:** Avoid naming global data files with reserved names (`page`, `content`, `collections`, `eleventy`).

---

## Quick Reference

| Debug Technique | Method |
| :--- | :--- |
| **Log Final Value** | `{{ variable \| debug }}` with custom filter |
| **Inspect Page Object** | `{{ page \| dump }}` (may crash on circular refs) |
| **Trace Source** | Remove data files one by one and rebuild |
| **Check Cascade** | Create minimal reproduction with single file |

---

_This guide covers debugging data origins. Natural progressions include **computed data for overrides**, **directory data patterns**, and **environment-aware configurations**._

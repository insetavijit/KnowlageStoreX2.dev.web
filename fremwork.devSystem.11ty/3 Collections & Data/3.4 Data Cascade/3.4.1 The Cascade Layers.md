# The Data Cascade: A Professional Mental Model

The Data Cascade is Eleventy's **most powerful and most misunderstood feature**. It determines how variables from multiple sources merge together to create the final data available in your templates. Understanding the cascade transforms confusing "why is this variable undefined?" moments into predictable, debuggable data flow.

---

## The Fundamental Principle: Layers of Truth

Think of the Data Cascade as **geological strata**. Each layer adds information on top of the previous layers. When two layers define the same key, the higher layer wins—but the lower layers remain available for any keys that aren't overridden.

```
┌─────────────────────────────┐  ← Computed Data (Highest Priority)
│  eleventyComputed           │
├─────────────────────────────┤
│  Front Matter               │  ← Template's own YAML
├─────────────────────────────┤
│  Template Data Files        │  ← Same name as template
├─────────────────────────────┤
│  Layout Front Matter        │  ← Data from layouts
├─────────────────────────────┤
│  Directory Data Files       │  ← folder.11tydata.js
├─────────────────────────────┤
│  Global Data Files          │  ← _data/*.json
└─────────────────────────────┘  ← Lowest Priority
```

Data flows **upward**. A value defined in `_data/site.json` is available everywhere unless something higher overrides it.

---

## The Complete Priority Order

From **lowest** (easily overridden) to **highest** (final word):

| Priority | Source | Example |
| :--- | :--- | :--- |
| 1 | **Computed Data in Config** | `eleventyConfig.addGlobalData()` |
| 2 | **Global Data Files** | `_data/site.json` |
| 3 | **Directory Data** | `posts/posts.11tydata.js` |
| 4 | **Template Data Files** | `about.11tydata.json` (matches `about.md`) |
| 5 | **Layout Front Matter** | Data in the layout's YAML |
| 6 | **Template Front Matter** | The content file's own YAML |
| 7 | **Computed Data** | `eleventyComputed` in front matter |

**The Rule:** A higher-priority source **always wins** when the same key is defined at multiple levels.

---

## How Layers Combine

Consider this scenario:

**`_data/site.json`:**
```json
{
  "siteName": "My Blog",
  "author": "Jane"
}
```

**`posts/posts.11tydata.json`:**
```json
{
  "layout": "post.njk",
  "author": "Blog Team"
}
```

**`posts/hello.md`:**
```yaml
---
title: "Hello World"
author: "John"
---
```

When Eleventy processes `posts/hello.md`, the template has access to:

```javascript
{
  siteName: "My Blog",   // From Global (only source)
  layout: "post.njk",    // From Directory (only source)
  title: "Hello World",  // From Front Matter (only source)
  author: "John"         // Front Matter wins over Directory and Global
}
```

The `author` key exists at three levels. Front Matter has the highest priority, so "John" wins.

---

## Visualizing Data Flow

A helpful mental model is to imagine Eleventy **walking up a folder tree** and **collecting data bags** along the way.

```
project/
├── _data/                   ① Global bag
│   └── site.json
├── posts/
│   ├── posts.11tydata.json  ② Directory bag
│   └── hello.md             ③ Template bag (Front Matter)
```

For `posts/hello.md`:
1. Eleventy picks up the Global bag (`site.json`)
2. Walks into `posts/`, picks up the Directory bag (`posts.11tydata.json`)
3. Opens `hello.md`, picks up the Front Matter bag
4. Merges everything, with later bags overriding earlier ones

---

## The Layout Layer (Special Case)

Layouts participate in the cascade, but their position is subtle:

1. Content front matter is collected
2. Eleventy checks `layout: post.njk`
3. Layout's front matter is merged **under** the content's front matter

This means:
- Layout sets defaults
- Content overrides them

```html
<!-- _includes/post.njk -->
---
showAuthor: true
showDate: true
---
```

```markdown
<!-- posts/private.md -->
---
layout: post.njk
showAuthor: false  ← Overrides layout default
---
```

The final `showAuthor` is `false` because Front Matter beats Layout.

---

## Chained Layouts and Cascading

When layouts chain (post.njk uses base.njk), data cascades through the chain:

```
base.njk:     siteName: "My Blog"
  └── post.njk:   showAuthor: true
      └── article.md:  title: "Hello"
```

The final merged data:
```javascript
{
  siteName: "My Blog",    // From base.njk
  showAuthor: true,       // From post.njk
  title: "Hello"          // From article.md
}
```

Each layer adds its data, with closer-to-content layers winning conflicts.

---

## Common Pitfalls and Solutions

**Problem:** Variable is undefined in template despite being in `_data/`.

**Cause:** Typo in filename or folder structure. `_data/Site.json` (capital S) might not match `site` reference.

**Solution:** Eleventy uses **exact filename** (without extension) as the data key. `site.json` becomes `site`, not `Site`.

---

**Problem:** Directory data doesn't apply to nested folders.

**Cause:** By default, `posts.11tydata.json` only applies to files directly in `posts/`, not subfolders like `posts/2024/`.

**Solution:** Use `posts.11tydata.js` with dynamic logic, or place another data file in the subfolder.

---

**Problem:** Layout defaults always get overridden by empty strings.

**Cause:** Front matter `author: ""` is defined, so it "wins" even though it's empty.

**Solution:** Remove the key entirely from front matter if you want the layout default, or use computed data to check for emptiness.

---

**Problem:** Can't figure out where a value came from.

**Solution:** Use `console.log` in an `addCollection` callback or create a debug filter:

```javascript
eleventyConfig.addFilter("debug", (value) => {
  console.log(value);
  return value;
});
```

```html
{{ page | debug }}
```

---

## Quick Reference

| Layer | File Pattern | Scope |
| :--- | :--- | :--- |
| **Global** | `_data/*.json` | All templates |
| **Directory** | `folder/folder.11tydata.js` | Files in that folder |
| **Template** | `filename.11tydata.json` | Matches specific file |
| **Layout** | Front matter in layout | Templates using that layout |
| **Front Matter** | `---` block in template | That template only |
| **Computed** | `eleventyComputed` | Final pass, can reference others |

---

_This guide establishes the mental model for the Data Cascade. Natural progressions include **deep merge configuration**, **computed data techniques**, and **debugging data inheritance**._

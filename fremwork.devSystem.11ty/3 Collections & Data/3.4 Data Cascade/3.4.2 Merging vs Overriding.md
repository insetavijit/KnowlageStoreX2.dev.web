# Merging vs Overriding: How Data Combines

The Data Cascade doesn't just stack layers—it **combines** them. Understanding when Eleventy replaces values versus merging them is essential for designing predictable data structures.

---

## The Fundamental Principle: Type Determines Behavior

**Primitive values** (strings, numbers, booleans) are **overridden**. The higher-priority layer wins completely.

**Objects** are **merged**. Keys from both layers combine, with conflicts resolved by priority.

**Arrays** are **replaced by default**, but can be configured to merge.

---

## Primitive Override (Simple Replacement)

When both layers define the same key as a primitive:

**Global Data (`_data/site.json`):**
```json
{
  "author": "Jane Doe"
}
```

**Front Matter:**
```yaml
---
author: "John Smith"
---
```

**Result:**
```javascript
{ author: "John Smith" }  // Front Matter wins
```

There's no "combination" possible. One string replaces another.

---

## Object Merging (Key Combination)

When both layers define the same key as an object:

**Global Data:**
```json
{
  "social": {
    "twitter": "@site",
    "facebook": "sitepage"
  }
}
```

**Front Matter:**
```yaml
---
social:
  twitter: "@personal"
  linkedin: "in/john"
---
```

**Result (with default merge behavior):**
```javascript
{
  social: {
    twitter: "@personal",  // Front Matter overrides Global
    facebook: "sitepage",  // Preserved from Global
    linkedin: "in/john"    // Added from Front Matter
  }
}
```

The `social` object **merges**. Each key inside is compared:
- `twitter` exists in both → Front Matter wins
- `facebook` only in Global → Preserved
- `linkedin` only in Front Matter → Added

---

## Array Behavior (Replace by Default)

Arrays are trickier. By default, the higher-priority layer **replaces** the entire array:

**Directory Data:**
```json
{
  "authors": ["Alice", "Bob"]
}
```

**Front Matter:**
```yaml
---
authors:
  - "Charlie"
---
```

**Result (default):**
```javascript
{ authors: ["Charlie"] }  // Entire array replaced
```

If you expected `["Alice", "Bob", "Charlie"]`, you need to configure **Deep Merge**.

---

## Enabling Deep Merge

Eleventy 2.0+ defaults to shallow merge for arrays. To enable deep merging (array concatenation):

```javascript
// eleventy.config.js
module.exports = function(eleventyConfig) {
  eleventyConfig.setDataDeepMerge(true);
};
```

With this enabled, arrays concatenate instead of replace.

---

## Special Case: Tags

The `tags` key receives special handling. Even without deep merge, Eleventy **always combines tags** from all cascade layers:

**Directory Data:**
```json
{
  "tags": ["blog"]
}
```

**Front Matter:**
```yaml
---
tags:
  - featured
---
```

**Result:**
```javascript
{ tags: ["blog", "featured"] }  // Always combined
```

This is hardcoded behavior because fracturing tags would break collections.

---

## Controlling Merge Depth

With `setDataDeepMerge(true)`, nested objects merge recursively:

```javascript
// Level 1: site
//   Level 2: navigation
//     Level 3: items

// All levels merge if both data sources define objects at each level
```

For very complex structures, this can cause unexpected combinations. Test your data cascade carefully.

---

## Explicit Override (Escape Hatch)

If you need to **prevent** merging for a specific key (force replacement even for objects), you can structure your data differently:

**Instead of:**
```yaml
social:
  twitter: "@new"
```

**Use:**
```yaml
social: { twitter: "@new" }  # Inline object → replaces entirely
```

Or handle it in computed data by explicitly setting the final value.

---

## Common Pitfalls and Solutions

**Problem:** Nested object keys accumulate unexpectedly.

**Cause:** Deep merge combines all keys from all layers.

**Solution:** Design data structures intentionally. Use shallow structures where possible, or explicitly clear keys in front matter (`key: null`).

---

**Problem:** Array-based settings (like scripts) don't combine.

**Cause:** Default shallow merge replaces arrays.

**Solution:** Enable `setDataDeepMerge(true)` or manually combine in computed data.

---

**Problem:** Can't figure out why a value has unexpected properties.

**Solution:** Use a debug filter to log the final merged object.

---

## Quick Reference

| Type | Default Behavior | With Deep Merge |
| :--- | :--- | :--- |
| **String/Number** | Replace | Replace |
| **Boolean** | Replace | Replace |
| **Object** | Merge keys | Deep merge keys |
| **Array** | Replace | Concatenate |
| **Tags** | Always merge | Always merge |

---

_This guide covers merge behavior. Natural progressions include **data deep merge configuration**, **computed data for override control**, and **debugging merged objects**._

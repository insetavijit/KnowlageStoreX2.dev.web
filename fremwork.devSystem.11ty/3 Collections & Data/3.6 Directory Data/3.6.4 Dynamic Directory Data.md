# Dynamic Directory Data: JavaScript Power

While JSON files are static, JavaScript directory data files (`.11tydata.js`) can execute logic, access environment variables, and compute values—bringing full programming capability to folder-level configuration.

---

## The Fundamental Principle: Computed Defaults

Instead of hardcoding values, you can calculate them:

```javascript
// posts/posts.11tydata.js
module.exports = {
  layout: "post.njk",
  buildDate: new Date().toISOString()
};
```

Every post in the folder gets a `buildDate` reflecting when the site was built.

---

## Function Export Pattern

For more control, export a function:

```javascript
module.exports = function() {
  return {
    environment: process.env.ELEVENTY_ENV || "development",
    showDrafts: process.env.SHOW_DRAFTS === "true"
  };
};
```

The function runs once per build.

---

## Environment-Specific Defaults

```javascript
const isProd = process.env.NODE_ENV === "production";

module.exports = {
  baseUrl: isProd 
    ? "https://example.com" 
    : "http://localhost:8080",
  showAds: isProd
};
```

Development builds get localhost URLs; production gets the real domain.

---

## Parsing Information from Context

You can derive data from the folder structure itself:

```javascript
// blog/2024/2024.11tydata.js
const path = require('path');

module.exports = () => {
  const folderName = path.basename(__dirname); // "2024"
  return {
    year: parseInt(folderName, 10),
    tags: [folderName]
  };
};
```

Now every file in `/blog/2024/` automatically gets tagged with "2024".

---

## Async Directory Data

For external lookups:

```javascript
module.exports = async function() {
  // Hypothetical: fetch default author from CMS
  const author = await fetchDefaultAuthor();
  return {
    author: author,
    layout: "post.njk"
  };
};
```

Use this sparingly—it runs for every file in the directory.

---

## Common Patterns

**Date-Based Defaults:**
```javascript
module.exports = {
  year: new Date().getFullYear()
};
```

**Feature Flags:**
```javascript
module.exports = {
  enableNewFeature: process.env.NEW_FEATURE === "true"
};
```

**Debug Mode:**
```javascript
module.exports = {
  debug: process.env.DEBUG === "true"
};
```

---

## Common Pitfalls and Solutions

**Problem:** JavaScript changes don't apply after rebuild.

**Cause:** Node.js caches `require()` calls.

**Solution:** Restart the dev server, or export a function instead of an object.

---

**Problem:** Environment variable is `undefined`.

**Solution:** Provide a fallback: `process.env.VAR || "default"`.

---

## Quick Reference

| Export Type | Syntax | Caching |
| :--- | :--- | :--- |
| **Object** | `module.exports = {}` | May be cached |
| **Function** | `module.exports = () => {}` | Fresh each run |
| **Async** | `module.exports = async () => {}` | Supports await |

---

_This guide covers dynamic directory data. Natural progressions include **computed data** and **troubleshooting scope**._

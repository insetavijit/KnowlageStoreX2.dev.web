| **Subtopic** | **Focus & Purpose** | **Key Concepts / Details** | **One-Line Recall** |
| :--- | :--- | :--- | :--- |
| **3.1.3 Custom API Collections** | Programmatic Definition | `addCollection`; JavaScript filtering; Complex logic | Building your own database queries. |
| **[[3.1.3.1 The addCollection API]]** | Setup | `eleventyConfig.addCollection("name", fn)`; Define in config | Registering the query. |
| **[[3.1.3.2 Filtering Logic]]** | Selection | `collection.getAll()`, `.filter()`, `.sort()`; arbitrary JS logic | Filtering the list using code. |
| **[[3.1.3.3 Performance Helpers]]** | Efficiency | `getFilteredByTag`, `getFilteredByGlob`; Optimized internal methods | Fast ways to get subsets. |
| **[[3.1.3.4 Custom Sorting]]** | Order | Sorting by Front Matter values (e.g., `order`, `weight`) | Changing the default date sort. |
| **[[3.1.3.5 Grouping Data]]** | Structure | Grouping items by custom fields (Year, Author, Category) | Grouping the results. |

# 3.1.3 Custom API Collections

Tag-based collections are easy, but limited. If you need to group content by "Folder", "File Extension", or complex criteria like "Posts from 2023 with 'featured: true'", you need the **Configuration API**.

---

## 3.1.3.1 The `addCollection` API

In your `.eleventy.js` file, you can define a collection using JavaScript.

```javascript
module.exports = function(eleventyConfig) {
  eleventyConfig.addCollection("myCustomList", function(collectionApi) {
    // 1. Get every file
    const all = collectionApi.getAll();
    
    // 2. Return a filtered array
    return all.filter(item => item.url.includes("/blog/"));
  });
};
```

You can now use `collections.myCustomList` in your templates.

---

## 3.1.3.2 Performance Helpers

Using `.getAll().filter()` is flexible but slow for massive sites. Eleventy provides optimized helper methods on the `collectionApi` object.

*   `getFilteredByTag("post")`: Faster than filtering manually.
*   `getFilteredByGlob("src/posts/*.md")`: Extremely fast file-system lookup.

**Example**:
```javascript
eleventyConfig.addCollection("posts", function(collectionApi) {
  return collectionApi.getFilteredByGlob("src/content/posts/**/*.md");
});
```

Using globs allows you to decouple your collections from Front Matter tags entirely.

---

## 3.1.3.3 Custom Sorting

By default, everything is sorted by Date. If you want to sort by a custom front matter field called `order`:

```javascript
eleventyConfig.addCollection("sidebar", function(collectionApi) {
  return collectionApi.getAll()
    .filter(item => item.data.order) // Ensure it has an order
    .sort((a, b) => {
      // Ascending (1, 2, 3)
      return a.data.order - b.data.order; 
    });
});
```

**Note**: The `.sort()` method mutates the array in place in standard JS, but in Eleventy configuration functions, it's safer to chain it off of a `.filter()` which returns a new array instance.

---

## 3.1.3.4 Grouping Data (Advanced)

True power comes from restructuring the data. A collection doesn't *have* to be a flat array of Post objects; it can be an Object of arrays.

**Goal**: `collections.postsByYear`

```javascript
eleventyConfig.addCollection("postsByYear", function(collectionApi) {
  const posts = collectionApi.getFilteredByTag("post");
  const postsByYear = {};

  posts.forEach(post => {
    const year = post.date.getFullYear();
    if (!postsByYear[year]) {
      postsByYear[year] = [];
    }
    postsByYear[year].push(post);
  });

  return postsByYear;
});
```

**Usage in Template**:
```html
{% for year, posts in collections.postsByYear %}
  <h2>{{ year }}</h2>
  <ul>
    {% for post in posts %}...{% endfor %}
  </ul>
{% endfor %}
```

---

## 3.1.3.5 Memoization

Eleventy computes custom collections **once** during the build process. It does not re-run the `addCollection` function for every page template. This makes filtered collections significantly more performant than doing complex filtering inside your Nunjucks templates.

---

## Quick Reference

| Method | Purpose | Speed |
| :--- | :--- | :--- |
| `getAll()` | Returns everything. | Slowest (if filtered manually). |
| `getFilteredByTag(tag)` | Returns items with tag. | Fast. |
| `getFilteredByGlob(pattern)` | Returns items matching path. | Fastest. |
| `getFilteredByTags(tags)` | Returns items with *all* tags. | Medium. |

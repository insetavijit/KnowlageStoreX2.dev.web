| **Subtopic** | **Focus & Purpose** | **Key Concepts / Details** | **One-Line Recall** |
| :--- | :--- | :--- | :--- |
| **3.1.5 Collection Debugging** | Troubleshooting | Circular JSON; `console.log`; Filters | Finding missing posts. |
| **[[3.1.5.1 The Circular Problem]]** | Crash | `JSON.stringify` fails on collections because items reference themselves (Prev/Next) | Don't print the whole object. |
| **[[3.1.5.2 The 'log' Filter]]** | Tool | Creating a custom filter to `console.log` on the server | Print to terminal. |
| **[[3.1.5.3 Inspecting Keys]]** | Technique | Printing `item | keys` to see available data without crashing | Look at the shape. |
| **[[3.1.5.4 Debugging in Config]]** | Setup | `console.log` inside `addCollection` to verify the array before templates run | Debug at source. |
| **[[3.1.5.5 Common 'Missing' Causes]]** | Checklist | `eleventyExcludeFromCollections`; Future Dates; Drafts | Why isn't it showing up? |

# 3.1.5 Collection Debugging

New Eleventy users often try to do this:

```html
{{ collections.all | dump }}
```

And the build crashes with `TypeError: Converting circular structure to JSON`.

Because every Collection Item has links to `next` and `previous` items (which link back to the original item), the object is infinite. You cannot simply "print" a collection.

---

## 3.1.5.1 The 'log' Filter

The best way to debug is to send data to your terminal (standard output), not the browser.

**Add this to `.eleventy.js`**:
```javascript
eleventyConfig.addFilter("log", (value) => {
  console.log(value);
  return ""; // Return empty string so nothing renders in HTML
});
```

**Usage**:
```html
{{ collections.post | log }}
```

This will print `[Object object]` to your terminal. To see details, log specific properties:

```html
{% for p in collections.post %}
  {{ p.data.title | log }}
{% endfor %}
```

---

## 3.1.5.2 Safe Inspection (Keys)

If you want to see what is available on an object without crashing the build, use the Nunjucks `dump` filter on the **keys** only.

```html
{{ collections.post[0] | keys | dump }}
```

**Output**:
`["data", "templateContent", "url", "date", "inputPath", "outputPath", "fileSlug"]`

This tells you the structure without trying to traverse the infinite relationships.

---

## 3.1.5.3 Debugging in Configuration

Sometimes it is easier to debug *before* the templates run. You can inspect your collections directly inside `.eleventy.js`.

```javascript
eleventyConfig.addCollection("debugPosts", (collectionApi) => {
  const posts = collectionApi.getFilteredByTag("post");
  
  // Log the count
  console.log(`Found ${posts.length} posts.`);
  
  // Log the timestamps
  posts.forEach(p => console.log(p.date));
  
  return posts;
});
```

Verify that the count matches your expectation. If it says "0", your tags are wrong.

---

## 3.1.5.4 Common "Missing Item" Causes

If a file exists but isn't showing up in `collections.post`:

1.  **Drafts**: Did you create a `.gitignore` that ignores `_drafts`? Eleventy respects gitignore.
2.  **Excludes**: check for `eleventyExcludeFromCollections: true` in Front Matter or Directory Data files.
3.  **Future Dates**: By default, Eleventy *does* show future posts, but some starters add a custom filter to hide them. Check your filters.
4.  **Typos**: `tags: "Post"` vs `tags: "post"`.
5.  **Invalid YAML**: If the Front Matter is invalid, Eleventy might skip the file or fail to parse the tags.

---

## 3.1.5.5 The "dump" Filter (Safe Mode)

If you really want to print data to the HTML (e.g., for a debug UI), you must safely strip circular references. This typically requires a custom filter using a library like `safe-json-stringify`.

**Better Approach**:
Just inspect `item.data`. It usually doesn't have circular references.

```html
<pre>{{ post.data | dump(2) }}</pre>
```

---

## Quick Reference

| Method | Safety | Destination |
| :--- | :--- | :--- |
| `{{ obj }}` | **Unsafe** (Crash) | HTML |
| `{{ obj \| dump }}` | **Unsafe** (Crash) | HTML |
| `{{ obj \| log }}` | **Safe** | Terminal |
| `{{ obj.data \| dump }}` | **Safe** (Usually) | HTML |

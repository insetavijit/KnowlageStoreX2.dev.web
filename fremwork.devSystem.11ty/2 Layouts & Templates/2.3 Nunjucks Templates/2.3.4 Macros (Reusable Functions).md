| **Subtopic** | **Focus & Purpose** | **Key Concepts / Details** | **One-Line Recall** |
| :--- | :--- | :--- | :--- |
| **2.3.4 Macros (Reusable Functions)** | Component Logic | `{% macro %}`; arguments; `import`; `call` | Reusable UI functions. |
| **[[2.3.4.1 Defining a Macro]]** | Syntax | `{% macro name(arg) %}`; encapsulating HTML/Logic | A function that returns HTML. |
| **[[2.3.4.2 Default Arguments]]** | Flexibility | Setting defaults `(type="text")`; avoiding boilerplate | Optional parameters. |
| **[[2.3.4.3 Importing Macros]]** | Usage | `{% from "file.njk" import macroName %}`; namespacing | Bring the tool into the file. |
| **[[2.3.4.4 The Caller Block]]** | composition | `{% call %}` tag; `{{ caller() }}`; passing content *into* a macro | Wrapping content with a macro. |
| **[[2.3.4.5 Scope Isolation]]** | Context | Macros do not see global variables by default; arguments essential | Pass everything it needs. |

# 2.3.4 Macros: Reusable Functions for HTML

If Layouts are the "Classes" of your site structure, **Macros** are the "Functions."

Macros allow you to define reusable chunks of HTML that accept arguments. They are the primary tool in Nunjucks for building a **Component Library** (Buttons, Cards, Form Fields) without duplicating code.

---

## 2.3.4.1 Defining a Macro

A macro looks exactly like a function definition in most programming languages.

```html
{% macro button(label, url) %}
  <a href="{{ url }}" class="btn btn-primary">
    {{ label }}
  </a>
{% endmacro %}
```

It outputs nothing until it is called.

---

## 2.3.4.2 Default Arguments

You can make arguments optional by assigning default values.

```html
{% macro input(name, type="text", placeholder="") %}
  <div class="form-group">
    <label for="{{ name }}">{{ name | title }}</label>
    <input type="{{ type }}" name="{{ name }}" id="{{ name }}" placeholder="{{ placeholder }}">
  </div>
{% endmacro %}
```

**Calling it**:
```html
{{ input("email") }} <!-- Uses type="text" -->
{{ input("password", type="password") }} <!-- Overrides type -->
```

---

## 2.3.4.3 Importing Macros

Macros are usually stored in dedicated files (e.g., `_includes/macros/forms.njk`). To use them, you must import them.

**Method A: Import specific macros**
```html
{% from "macros/forms.njk" import input, button %}

{{ input("username") }}
```

**Method B: Import whole file as namespace**
```html
{% import "macros/forms.njk" as forms %}

{{ forms.input("username") }}
```

Method B (Namespacing) is generally preferred for larger projects as it prevents naming collisions (`forms.button` vs `ui.button`).

---

## 2.3.4.4 The Caller Block (Advanced)

Sometimes you want to pass a *block* of content into a macro, rather than just a string argument. This is where `{% call %}` replaces `{{ }}`.

**Definition**:
```html
{% macro card(title) %}
  <div class="card">
    <h3>{{ title }}</h3>
    <div class="card-body">
      {{ caller() }} <!-- This injects the block content -->
    </div>
  </div>
{% endmacro %}
```

**Usage**:
```html
{% call card("My Card Title") %}
  <p>This is complex HTML content.</p>
  <ul>
    <li>Item 1</li>
    <li>Item 2</li>
  </ul>
{% endcall %}
```

This transforms macros from simple "String Replacers" into powerful "Wrapper Components."

---

## 2.3.4.5 Scope Isolation

**Crucial Mental Model**: Macros in Nunjucks are **Scope Agnostic**. They do *not* automatically have access to your global variables (`page`, `eleventy`, `collections`).

*   **Wrong**:
    ```html
    {% macro showTitle() %}
      <h1>{{ title }}</h1> <!-- Fails: 'title' is undefined inside macro -->
    {% endmacro %}
    ```

*   **Right**:
    ```html
    {% macro showTitle(titleText) %}
      <h1>{{ titleText }}</h1>
    {% endmacro %}
    
    {{ showTitle(title) }} <!-- Pass the global var in as an argument -->
    ```

You *can* force access by using `{% from "..." import ... with context %}`, but this makes macros brittle and hard to test. Prefer explicit argument passing.

---

## Quick Reference

| Concept | Key Point |
| :--- | :--- |
| **Syntax** | `{% macro name(args) %}...{% endmacro %}` |
| **Import** | `{% from "file" import macro %}` or `{% import "file" as func %}` |
| **Arguments** | Supports defaults (`arg="val"`). Pass globals explicitly. |
| **Scope** | Macros are isolated. They don't see `page.url` unless you pass it. |
| **Call** | Use `{% call %}` and `{{ caller() }}` for passing HTML blocks. |

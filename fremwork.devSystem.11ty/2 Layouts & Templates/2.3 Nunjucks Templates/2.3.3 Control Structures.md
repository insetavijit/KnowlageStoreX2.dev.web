| **Subtopic** | **Focus & Purpose** | **Key Concepts / Details** | **One-Line Recall** |
| :--- | :--- | :--- | :--- |
| **2.3.3 Control Structures** | Logic Flow | `if`/`else`, `for` loops, Loop Context | Directing the template rendering. |
| **[[2.3.3.1 Conditional Logic]]** | Branching | `{% if env == 'prod' %}`; `{% elif %}`; `{% else %}` | If this, then that. |
| **[[2.3.3.2 Loops (For In)]]** | Iteration | `{% for item in collection %}`; iterating Arrays vs Objects | Repeat for every item. |
| **[[2.3.3.3 Loop Variables]]** | Context | `loop.index`, `loop.first`, `loop.last`, `loop.length` | Knowing where you are in the list. |
| **[[2.3.3.4 The `else` Loop Clause]]** | Fallbacks | `{% else %}` inside a `for` loop (runs if array is empty) | What to do if the list is empty. |
| **[[2.3.3.5 Async Control]]** | Advanced | `{% asyncAll %}`; `{% asyncEach %}` (Nunjucks/11ty specific) | Handling async data fetches in loops. |

# 2.3.3 Control Structures: Logic in Markup

Static sites are rarely static in construction. They are dynamic programs that output static HTML. Control structures allow you to make decisions (`if`) and repeat patterns (`for`) based on your data.

---

## 2.3.3.1 Conditional Logic (`if`)

The syntax is standard for anyone familiar with Python or Jinja2.

```html
{% if user.isLoggedIn %}
  <button>Log Out</button>
{% elif user.isGuest %}
  <button>Sign Up</button>
{% else %}
  <button>Log In</button>
{% endif %}
```

**Evaluation Rules**:
*   Remembers Nunjucks Truthy/Falsy quirks (`0` is true!).
*   You can use logic operators: `and`, `or`, `not`.
*   Example: `{% if post.data.tags and not post.data.draft %}`.

---

## 2.3.3.2 Loops (`for`)

Loops are the workhorse of Eleventy, used to iterate over Collections.

**Array Iteration**:
```html
<ul>
{% for post in collections.posts %}
  <li>{{ post.data.title }}</li>
{% endfor %}
</ul>
```

**Object Iteration**:
You must use `item, key` syntax to iterate over objects.
```html
{% for key, val in myObject %}
  <p>{{ key }}: {{ val }}</p>
{% endfor %}
```

---

## 2.3.3.3 Loop Context Variables

Inside any `for` loop, Nunjucks provides a special `loop` object. This is incredibly useful for styling logic.

*   `loop.index`: 1-based index (1, 2, 3...)
*   `loop.index0`: 0-based index (0, 1, 2...)
*   `loop.revindex`: Reverse index (3, 2, 1...)
*   `loop.first`: Boolean (True if this is the first item)
*   `loop.last`: Boolean (True if this is the last item)
*   `loop.length`: Total count of items

**Example: Comma Separated List**
```html
{% for tag in tags %}
  <a href="/tags/{{ tag }}">{{ tag }}</a>{% if not loop.last %}, {% endif %}
{% endfor %}
```
*Output*: "Tech, Design, Life" (No trailing comma!).

---

## 2.3.3.4 The `else` Loop Clause

A lesser-known but clean pattern in Nunjucks is the `else` block *attached to a for loop*. This block runs only if the array is empty (or undefined).

**Without `else`**:
```html
{% if posts.length %}
  {% for post in posts %}...{% endfor %}
{% else %}
  No posts found.
{% endif %}
```

**With `else` (Cleaner)**:
```html
{% for post in posts %}
  <h1>{{ post.title }}</h1>
{% else %}
  <p>No posts found.</p>
{% endfor %}
```

---

## 2.3.3.5 Async Control (Advanced)

Eleventy relies heavily on asynchronous data. Sometimes you need to iterate over something that returns a Promise. Standard `{% for %}` is synchronous.

Use `{% asyncEach %}` or `{% asyncAll %}` (from `nunjucks-async-loader`, which Eleventy uses internally) if you are doing heavy async operations inside a loop, though in standard Eleventy usage, data is usually resolved *before* it hits the template, so the standard `{% for %}` is usually robust enough.

---

## Quick Reference

| Structure | Syntax | Key Note |
| :--- | :--- | :--- |
| **If** | `{% if condition %}...{% endif %}` | `0` is true. Empty string `""` is false. |
| **For** | `{% for x in y %}...{% endfor %}` | Supports `else` for empty lists. |
| **Index** | `{{ loop.index }}` | 1-based counting. Use `index0` for 0-based. |
| **Separators** | `{% if not loop.last %}, {% endif %}` | The classic comma pattern. |
| **Operators** | `and`, `or`, `not`, `==`, `!=` | Python-style words, not JS symbols (`&&`). |
